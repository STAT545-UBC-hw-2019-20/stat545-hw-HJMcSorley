---
title: 'Assignment 3: dplyr/ggplot2 Part II'
author: "Hannah McSorley"
date: "Due: 01/10/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Homework Assignment 3

The Objective of this assignment is to use the dplyr package to manipulate and explore a dataset, and to create accompanying visualizations with ggplot2. This is an extension of the Homework 02 assignment, and will continue the exploration of the 'gapminder' dataset. Three of six tasks were chosen to complete Homework Assignment 03, each task should produc:
    *a tibble, using dplyr as your data manipulation tool;
    *an accompanying plot of data from the tibble, using ggplot2 as your visualization tool; and
    *some dialogue about what your tables/figures show (doesnâ€™t have to be much).


```{r}
suppressPackageStartupMessages(library(gapminder))  # data set
suppressPackageStartupMessages(library(tidyverse))  
# tidyverse includes package 'dplyr' and ggplot2
suppressPackageStartupMessages(library(knitr))  # tidy tables
suppressPackageStartupMessages(library(DT))  # tidy dataframe tables for HTML
suppressPackageStartupMessages(library(ggridges))
```

#1: Task Option 2

_Get the maximum and minimum of GDP per capita for all continents._

Here, I used dplyr and the piping operator to summarize the gapminder data set for each continent's minimum and maximum GDP per capita. In addition, the country associated with each continent's min and max GDP per capita is noted. 

```{r one-tibble}
str(gapminder)  # structure

# tibble: # minimum and maximum GDP per capita for all continents
# create a "where/when" column 
# sort from smallest to largest min GDP
gapminder %>% 
  group_by(continent) %>% 
  summarize(gdpPercap_min = min(gdpPercap),
            ww_Min. = paste(" (", year[gdpPercap == gdpPercap_min], ") ", 
                            country[gdpPercap == gdpPercap_min], sep = ""),
            gdpPercap_max = max(gdpPercap), 
            ww_Max. = paste(" (", year[gdpPercap == gdpPercap_max], ") ", 
                            country[gdpPercap == gdpPercap_max], sep = "")) %>% 
  arrange(gdpPercap_min) %>% 
  kable(digits = 0, caption = "Extreme GDPs per capita by continent",
        col.names = c("Continent", 
                      "Min. GDP/capita ($)", 
                      "when/where Min. occurred",
                      "Max. GDP/capita ($)", 
                      "when/where Max. occurred"))

```

Overall, the lowest GDP per capita was 241 USD which was recorded in Africa (Democratic Republic of Congo) in 2002.The maximum GDP per capita in the gapminder data set was recorded in Asia (Kuwait) in 1957 at 113,523 USD. 
The continent of Africa had its lowest GDP in 2002, and highest in 1977. Asia experienced both minimum and maximum GDP in the 1950's (1952 and 1957, respectfully). Europe appears to have generally increased its GDP over time, as the lowest was recorded in 1952 and the highest was recorded in 2007. The Americas experienced both minimum and maximum continental GDP per capita in 2007, where the minimum occured in Haiti and the maximum occured in the Uniter States. Oceania had lowest GDP per capita in 1952 and highest in 2007, both occurred in Australia.     

```{r one-plot}

# plot: GDP per capita for each continent 
# hightlight the min and max with box plots
# y axis on a log scale
gapminder %>%
  ggplot(aes(x = continent, y = gdpPercap, fill = continent)) +
  geom_boxplot(alpha = 0.2) +
  geom_jitter(aes(fill = continent), alpha = 0.5, shape = 21) +
  scale_y_log10("GDP per capita (USD)", labels = scales::dollar_format()) + 
  xlab("Continent") +
  theme_light() +
  theme(legend.position = "none") +
  stat_summary(fun.y = min, geom = "point", shape = 24, size = 3, inherit.aes = TRUE) +
  stat_summary(fun.y = max, geom = "point", shape = 25, size = 3, inherit.aes = TRUE) 

# I could only get the min and max triangles to show in the same legend, which looked weird
```

This plot shows GDP per capita in each continent. The boxplots show the distribution of GDP data in each continent, while the triangle markers indicate the minimum and maximum values for each continent and the scatter points show all the data available in the gapminder data set.

_Note_: There is no legend in this plot; I wasn't able to separate the geoms from one another in the legend, so I removed it entirely.




______________________________________

#Task Option 3

_Look at the spread of GDP per capita within the continents._

* check this out: https://www.stat.ubc.ca/~jenny/STAT545A/hw03_dataAggregation.html

```{r INPROGRESS}
# tibble
# what's the mean, relative standard deviation, mode, min and max GDP per capita?
gapminder %>% 
  group_by(continent) %>% 
  summarize(mean_gdpp = mean(gdpPercap),
            sd_gdpp = sd(gdpPercap),
            rsd_gdpp = (sd(gdpPercap) / mean_gdpp) * 100, 
            min_gdpp = min(gdpPercap),
            med_gdpp = median(gdpPercap),
            max_gdpp = max(gdpPercap)) %>% 
  kable(digits = 0, caption = "GDP per capita by continent",
        col.names = c("continent", "Mean GDP ($)", "S.D (+/- $)", "RSD (+/- %)", "Min ($)", "Median ($)", "Maximum ($)"))

# plot boxplot
# put GDP on a log scale again
gapminder %>% 
  ggplot(aes(x = continent, y = gdpPercap)) +
  geom_boxplot() +
  labs(y = "GDP per capita", x = "") +
  scale_y_log10("GDP per capita", labels = scales::dollar_format()) +
  theme_light()

# plot ridge plot
gapminder %>% 
  ggplot(aes(x = gdpPercap, y = continent, colour = continent)) +
  ggridges::geom_density_ridges(aes(fill = continent), alpha = 0.2) +
  ylab("") +
  scale_x_log10("GDP per capita", labels = scales::dollar_format()) +
  theme_light()
```


#Task Option 5
_How is life expectancy changing over time on different continents?_


```{r INPROGRES}
# calculate the difference in life expectancy over time for each country
# filter for those with a drop in life expectancy 
gapminder %>% 
  dplyr::arrange(continent, year) %>% 
  group_by(continent) %>% 
  summarize(tenyr_chng = tsibble::difference(lifeExp, lag = 10)) %>% 
  #filter(change_lifeExp < 0) %>% 
  #head() %>%
  kable(digits = 2)
  
# unclear intruction about including a new variable for the increase in life expectancy... 
# when we're filtering for the drop in life expectancy

# maybe something that identifes whether there was an increase or decrease?
gapminder %>% 
  arrange(country, year) %>% 
  drop_na() %>% 
  mutate(change_lifeExp = tsibble::difference(lifeExp),
         incr_lifeExp = (change_lifeExp > 0)) %>%
  head() %>%  
  kable(digits = 2)
# provides TRUE or FALSE indicator of whether the lifeExp increased for that entry,
# relative to the previous data

# filter the above to include only entries that have had a drop in life expectancy
gapminder %>% 
  arrange(country, year) %>% 
  drop_na() %>% 
  mutate(change_lifeExp = tsibble::difference(lifeExp),
         incr_lifeExp = (change_lifeExp > 0)) %>% 
  filter(incr_lifeExp == FALSE) %>% 
  select(country:change_lifeExp) %>% 
  kable(digits = 2, caption = "drop in life expectancy")

# 2 scatter plots
# these are similar facet plots like I plotted in Exercise 2 -- because I like it

# life expectancy per capita over time
gapminder %>%
  ggplot(aes(x = year, y = lifeExp)) + 
  geom_point() +
  geom_smooth(method = "loess") +
  facet_wrap(~ continent, ncol = 1) +
  labs(x = "", y = "Life Expectancy")


# plot life expectancy over time in each continent 
# get fancy with facet wrapping (multiple panels)
gapminder %>%
  ggplot(aes(x = year, y = lifeExp, colour = continent)) + 
  geom_point() + 
  geom_smooth(method = "loess", colour = "black") + 
  facet_wrap(~continent, nrow=1) +
  theme_light() +
  labs(y = "Life Expectancy", x = "")
## it would be better to have years (x-axis) on an angle (90*) or to only show every 20


# 'geom_freqpoly()'
# shows distribution (like a histogram) but with lines instead of shaded bars
gapminder %>% 
  ggplot(aes(x = lifeExp, color = continent)) +
  theme_bw() +
  labs(x = "Life Expectancy (yrs)", y = "distribution frequency count") +
  geom_freqpoly()

```
  




